# 测试计划（角色体系重构与监护机制）

## 范围与目标
- 覆盖角色双重化、监护关系管理、权限控制、微信邀请流程与时间选择规范。
- 验证多规则多监护场景与性能边界，确保安全与稳定。

## 单元测试
- 服务层方法：
  - 监护关系增删查：入参校验、唯一约束、异常路径。
  - 权限判断：规则级鉴权、过滤策略。
  - 时间选择：预设时间定位（08:00/12:00/19:00）逻辑。
- 覆盖率要求：新增方法 90%+。

## 集成测试
- 场景用例：
  - 多规则多监护人：批量选择规则并邀请/添加监护人；关系正确建立与展示。
  - 权限边界：无权限用户访问规则与打卡数据，服务端过滤与前端提示一致。
  - 微信邀请：不同环境能力下的邀请流程（成功/失败/环境不支持）。
  - 界面改造：规则详情的“管理监护人”、个人中心的“我监护的规则”状态同步与标识。
- 数据一致性：监护关系建立后页面实时刷新；跨页面状态一致。

## 性能与压力测试
- 并发建立监护关系：模拟 1000+ 并发，成功率、错误率、重试效果。
- 大数据量查询：在高基数关系下分页与查询耗时；目标响应时间与 QPS 指标。
- 资源占用：前端渲染性能（长列表）、后端查询与索引命中。

## 安全测试
- 鉴权绕过与越权访问：规则级权限校验防护。
- 输入校验与注入：用户名、ID 列表与邀请消息。
- 隐私保护：避免在日志与错误中暴露敏感信息。

## 测试数据与环境
- 构造规则与用户样本：覆盖不同规模与关系密度。
- 环境适配：小程序/企微/H5 的微信选择器能力差异与替代方案验证。

## 出入与验收标准
- 功能通过：所有核心用例通过，权限边界无漏。
- 性能达标：并发与查询指标满足目标；页面体验流畅。
- 缺陷关闭：重大与高优缺陷全部关闭；中低优缺陷评估与跟进。

