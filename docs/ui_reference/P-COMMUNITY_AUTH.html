<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>安全守护 - 社区身份验证</title>
    <script src="https://unpkg.byted-static.com/coze/space_ppt_lib/1.0.3-alpha.12/lib/tailwindcss.js"></script>
    <script src="https://unpkg.byted-static.com/fortawesome/fontawesome-free/6.7.2/js/all.min.js" data-auto-replace-svg="nest"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FAE9DB',
                        secondary: '#F48224', 
                        accent: '#624731',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444'
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif']
                    },
                    boxShadow: {
                        'card': '0 4px 12px rgba(0, 0, 0, 0.08)',
                        'button': '0 2px 8px rgba(244, 130, 36, 0.3)'
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #FAE9DB 0%, #F8E0D0 100%);
        }
        
        .submit-button {
            background: linear-gradient(135deg, #F48224 0%, #E8741A 100%);
            box-shadow: 0 4px 16px rgba(244, 130, 36, 0.4);
            transition: all 0.3s ease;
        }
        
        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(244, 130, 36, 0.5);
        }
        
        .submit-button:disabled {
            background: #D1D5DB;
            transform: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            cursor: not-allowed;
        }
        
        .upload-area {
            border: 2px dashed #D1D5DB;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            border-color: #F48224;
            background-color: rgba(244, 130, 36, 0.05);
        }
        
        .upload-area.dragover {
            border-color: #F48224;
            background-color: rgba(244, 130, 36, 0.1);
        }
        
        .status-bar {
            background: linear-gradient(135deg, #1F2937 0%, #374151 100%);
        }
        
        .form-input:focus {
            outline: none;
            border-color: #F48224;
            box-shadow: 0 0 0 3px rgba(244, 130, 36, 0.1);
        }
        
        .safe-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- iOS状态栏 -->
    <div id="status-bar" class="status-bar text-white text-sm flex justify-between items-center px-4 py-1">
        <div class="flex items-center space-x-1">
            <span>9:41</span>
        </div>
        <div class="flex items-center space-x-1">
            <i class="fas fa-signal text-xs"></i>
            <i class="fas fa-wifi text-xs"></i>
            <i class="fas fa-battery-three-quarters text-xs"></i>
        </div>
    </div>

    <!-- 主容器 -->
    <div id="main-container" class="min-h-screen gradient-bg">
        <!-- 顶部导航栏 -->
        <header id="top-nav" class="flex items-center justify-between px-6 py-4">
            <button id="back-button" class="w-10 h-10 rounded-full bg-white bg-opacity-80 flex items-center justify-center shadow-sm">
                <i class="fas fa-arrow-left text-accent"></i>
            </button>
            <h1 id="page-title" class="text-lg font-semibold text-accent">社区工作人员身份验证</h1>
            <div class="w-10"></div> <!-- 占位元素保持标题居中 -->
        </header>

        <!-- 主要内容区域 -->
        <main id="main-content" class="px-6 pb-8">
            <!-- 说明文字 -->
            <section id="description-section" class="mb-8">
                <div class="bg-white rounded-2xl shadow-card p-6">
                    <div class="flex items-start space-x-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-shield-alt text-blue-600 text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-accent mb-2">身份验证</h2>
                            <p class="text-sm text-gray-600 leading-relaxed">
                                为了确保社区服务的安全性和准确性，请您完成身份验证。验证通过后，您将获得社区管理权限，能够查看和管理辖区内独居者的相关信息。
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 验证表单 -->
            <section id="auth-form-section" class="space-y-6">
                <form id="auth-form" class="space-y-6">
                    <!-- 姓名输入 -->
                    <div id="name-input-container" class="space-y-2">
                        <label for="name-input" class="block text-sm font-medium text-accent">
                            姓名 <span class="text-danger">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="name-input" 
                            name="name" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-xl form-input bg-white text-gray-900 placeholder-gray-500"
                            placeholder="请输入您的真实姓名"
                            required
                        >
                        <div id="name-error" class="text-sm text-danger hidden">请输入您的姓名</div>
                    </div>

                    <!-- 工号/身份证号输入 -->
                    <div id="id-input-container" class="space-y-2">
                        <label for="id-input" class="block text-sm font-medium text-accent">
                            工号/身份证号 <span class="text-danger">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="id-input" 
                            name="idNumber" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-xl form-input bg-white text-gray-900 placeholder-gray-500"
                            placeholder="请输入您的工号或身份证号"
                            required
                        >
                        <div id="id-error" class="text-sm text-danger hidden">请输入有效的工号或身份证号</div>
                    </div>

                    <!-- 工作证明上传 -->
                    <div id="upload-container" class="space-y-2">
                        <label class="block text-sm font-medium text-accent">
                            工作证明照片 <span class="text-danger">*</span>
                        </label>
                        <div id="upload-area" class="upload-area w-full rounded-xl p-8 text-center cursor-pointer">
                            <input type="file" id="file-input" accept="image/*" class="hidden">
                            <div id="upload-placeholder" class="space-y-3">
                                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto">
                                    <i class="fas fa-cloud-upload-alt text-gray-400 text-2xl"></i>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-700">点击上传工作证明照片</div>
                                    <div class="text-xs text-gray-500 mt-1">支持 JPG、PNG 格式，文件大小不超过 5MB</div>
                                </div>
                            </div>
                            <div id="upload-preview" class="hidden">
                                <img id="preview-image" src="" alt="工作证明预览" class="w-full h-48 object-cover rounded-lg mx-auto">
                                <div class="mt-3">
                                    <button type="button" id="change-file-btn" class="text-sm text-secondary">更换照片</button>
                                    <button type="button" id="remove-file-btn" class="text-sm text-danger ml-4">删除</button>
                                </div>
                            </div>
                        </div>
                        <div id="upload-error" class="text-sm text-danger hidden">请上传工作证明照片</div>
                    </div>

                    <!-- 提交按钮 -->
                    <div id="submit-container" class="pt-4">
                        <button 
                            type="submit" 
                            id="submit-button" 
                            class="submit-button w-full py-4 rounded-xl text-white font-semibold text-lg flex items-center justify-center space-x-2"
                        >
                            <span id="submit-text">提交验证</span>
                            <i id="submit-spinner" class="fas fa-spinner loading-spinner hidden"></i>
                        </button>
                    </div>
                </form>
            </section>

            <!-- 提示信息 -->
            <section id="tips-section" class="mt-8">
                <div class="bg-yellow-50 border border-yellow-200 rounded-2xl p-4">
                    <div class="flex items-start space-x-3">
                        <div class="w-6 h-6 bg-yellow-100 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                            <i class="fas fa-info-circle text-yellow-600 text-xs"></i>
                        </div>
                        <div class="text-sm text-yellow-800">
                            <p class="font-medium mb-1">温馨提示</p>
                            <p class="text-xs leading-relaxed">
                                验证信息提交后，我们将在1-3个工作日内完成审核。审核结果将通过短信和站内信通知您。请确保提供的信息真实有效。
                            </p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 成功提示弹窗 -->
    <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center px-6 z-50 hidden">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm">
            <div class="text-center space-y-4">
                <div class="w-16 h-16 bg-success bg-opacity-20 rounded-full flex items-center justify-center mx-auto">
                    <i class="fas fa-check text-success text-2xl"></i>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-accent mb-2">提交成功</h3>
                    <p class="text-sm text-gray-600">
                        验证信息已提交，请耐心等待审核。审核结果将通过短信和站内信通知您。
                    </p>
                </div>
                <button id="success-confirm-btn" class="submit-button w-full py-3 rounded-xl text-white font-semibold">
                    确定
                </button>
            </div>
        </div>
    </div>

    <!-- 错误提示弹窗 -->
    <div id="error-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center px-6 z-50 hidden">
        <div class="bg-white rounded-2xl p-6 w-full max-w-sm">
            <div class="text-center space-y-4">
                <div class="w-16 h-16 bg-danger bg-opacity-20 rounded-full flex items-center justify-center mx-auto">
                    <i class="fas fa-exclamation-triangle text-danger text-2xl"></i>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-accent mb-2">提交失败</h3>
                    <p id="error-message" class="text-sm text-gray-600">
                        提交失败，请检查信息是否完整并重试。
                    </p>
                </div>
                <button id="error-confirm-btn" class="submit-button w-full py-3 rounded-xl text-white font-semibold">
                    确定
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM 元素引用
            const backButton = document.querySelector('#back-button');
            const authForm = document.querySelector('#auth-form');
            const nameInput = document.querySelector('#name-input');
            const idInput = document.querySelector('#id-input');
            const fileInput = document.querySelector('#file-input');
            const uploadArea = document.querySelector('#upload-area');
            const uploadPlaceholder = document.querySelector('#upload-placeholder');
            const uploadPreview = document.querySelector('#upload-preview');
            const previewImage = document.querySelector('#preview-image');
            const changeFileBtn = document.querySelector('#change-file-btn');
            const removeFileBtn = document.querySelector('#remove-file-btn');
            const submitButton = document.querySelector('#submit-button');
            const submitText = document.querySelector('#submit-text');
            const submitSpinner = document.querySelector('#submit-spinner');
            const successModal = document.querySelector('#success-modal');
            const errorModal = document.querySelector('#error-modal');
            const successConfirmBtn = document.querySelector('#success-confirm-btn');
            const errorConfirmBtn = document.querySelector('#error-confirm-btn');
            const errorMessage = document.querySelector('#error-message');

            let uploadedFile = null;

            // 返回按钮点击事件
            backButton.addEventListener('click', function() {
                window.location.href = 'P-ROLE_SELECT.html';
            });

            // 表单验证函数
            function validateForm() {
                let isValid = true;
                
                // 验证姓名
                const name = nameInput.value.trim();
                if (!name) {
                    showError('name-error', '请输入您的姓名');
                    isValid = false;
                } else {
                    hideError('name-error');
                }

                // 验证工号/身份证号
                const idNumber = idInput.value.trim();
                if (!idNumber) {
                    showError('id-error', '请输入工号或身份证号');
                    isValid = false;
                } else if (idNumber.length < 6) {
                    showError('id-error', '请输入有效的工号或身份证号');
                    isValid = false;
                } else {
                    hideError('id-error');
                }

                // 验证文件上传
                if (!uploadedFile) {
                    showError('upload-error', '请上传工作证明照片');
                    isValid = false;
                } else {
                    hideError('upload-error');
                }

                return isValid;
            }

            // 显示错误信息
            function showError(errorId, message) {
                const errorElement = document.querySelector(`#${errorId}`);
                errorElement.textContent = message;
                errorElement.classList.remove('hidden');
            }

            // 隐藏错误信息
            function hideError(errorId) {
                const errorElement = document.querySelector(`#${errorId}`);
                errorElement.classList.add('hidden');
            }

            // 文件上传处理
            uploadArea.addEventListener('click', function() {
                if (!uploadedFile) {
                    fileInput.click();
                }
            });

            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    handleFileUpload(file);
                }
            });

            changeFileBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                fileInput.click();
            });

            removeFileBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                removeFile();
            });

            function handleFileUpload(file) {
                // 验证文件类型
                if (!file.type.startsWith('image/')) {
                    showError('upload-error', '请选择图片文件');
                    return;
                }

                // 验证文件大小 (5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showError('upload-error', '文件大小不能超过5MB');
                    return;
                }

                uploadedFile = file;
                hideError('upload-error');

                // 显示预览
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    uploadPlaceholder.classList.add('hidden');
                    uploadPreview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }

            function removeFile() {
                uploadedFile = null;
                fileInput.value = '';
                uploadPlaceholder.classList.remove('hidden');
                uploadPreview.classList.add('hidden');
                hideError('upload-error');
            }

            // 拖拽上传支持
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileUpload(files[0]);
                }
            });

            // 表单提交事件
            authForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!validateForm()) {
                    return;
                }

                // 显示加载状态
                setSubmitLoading(true);

                // 模拟提交过程
                setTimeout(function() {
                    // 模拟成功提交
                    setSubmitLoading(false);
                    showSuccessModal();
                }, 2000);
            });

            // 设置提交按钮加载状态
            function setSubmitLoading(loading) {
                if (loading) {
                    submitButton.disabled = true;
                    submitText.textContent = '提交中...';
                    submitSpinner.classList.remove('hidden');
                } else {
                    submitButton.disabled = false;
                    submitText.textContent = '提交验证';
                    submitSpinner.classList.add('hidden');
                }
            }

            // 显示成功弹窗
            function showSuccessModal() {
                successModal.classList.remove('hidden');
            }

            // 显示错误弹窗
            function showErrorModal(message) {
                errorMessage.textContent = message;
                errorModal.classList.remove('hidden');
            }

            // 成功弹窗确认按钮
            successConfirmBtn.addEventListener('click', function() {
                successModal.classList.add('hidden');
                // 跳转到社区数据看板页
                window.location.href = 'P-HOME_COMMUNITY.html';
            });

            // 错误弹窗确认按钮
            errorConfirmBtn.addEventListener('click', function() {
                errorModal.classList.add('hidden');
            });

            // 输入框实时验证
            nameInput.addEventListener('input', function() {
                if (this.value.trim()) {
                    hideError('name-error');
                }
            });

            idInput.addEventListener('input', function() {
                if (this.value.trim()) {
                    hideError('id-error');
                }
            });

            // 模拟实时时间更新
            function updateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: false 
                });
                document.querySelector('#status-bar span').textContent = timeString;
            }

            updateTime();
            setInterval(updateTime, 60000);
        });
    </script>
</body>
</html>